# Issue 092625-33: Sports Taxonomy & Allowlist Filtering

**Priority**: High  
**Component**: Backend / Taxonomy  
**Beta Blocker**: Yes (filters depend on sport)  
**Discovered**: 2025-09-26  
**Status**: New  
**Resolved**: 

## Problem Description

Opportunities currently lack a populated `sport` field. We must resolve sport via Polymarket sports tags and filter to a v1 allowlist, with a dev-mode override.

## Investigation Areas

1. Gamma `/sports` and tagId mapping to events/markets.  
2. Mapping normalization to consistent codes (e.g., `basketball_nba`, `baseball_mlb`).  
3. Settings-driven allowlist and dev-mode bypass.

## Expected Behavior

Each event/opportunity has a valid `sport` code. Unsupported sports are filtered out unless dev-mode is enabled.

## Files to Investigate

- `backend/app/services/polymarket.py`  
- `backend/app/services/opportunities.py`  
- `backend/app/core/config.py`

## Root Cause Analysis

1. **Primary Cause**: Sports tags not resolved/propagated in current normalization.  
2. **Contributing Factors**: Tag ID indirection and missing mapping cache.

## Solution Implemented

### 1. Taxonomy Mapping (⏳ In Progress)
- Fetch `/sports`, build tagId→sport map; annotate events.  
- Add allowlist setting; filter unsupported sports.

### Code Changes

**File Modified**: `backend/app/services/polymarket.py`

**Before**:
```text
Events come through with sport=None.
```

**After**:
```text
Events annotated with sport based on tags; filtered by allowlist.
```

## Testing Requirements

### Manual Testing Steps
1. Call `/api/opportunities`; verify sport populated.  
2. Modify allowlist and confirm filtering behavior.

### Test Scenarios
- [ ] Non-null sport for all surfaced events.  
- [ ] Filtering respects allowlist.  
- [ ] Dev-mode disables filtering.

## Status

**Current Status**: Planned  
**Last Updated**: 2025-09-26

### Implementation Checklist
- [ ] Implement sports mapping  
- [ ] Filter unsupported sports  
- [ ] Tests updated

### Completion Criteria (Ready for User Testing)
- [ ] Sport populated and filterable  
- [ ] All tests pass

### User Testing Confirmation
- [ ] User validates sport presence and filters  
- [ ] User approves moving to done/complete

### User Confirmation & Actions Required
- Provide preferred allowlist for v1; default to NBA/NFL/MLB/NHL/NCAAB/NCAAF if acceptable.

## Result

[TBD]


