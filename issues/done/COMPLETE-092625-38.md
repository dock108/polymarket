# Issue 092625-38: Freshness Plumbing & Staleness Policy

**Priority**: High  
**Component**: Backend / API  
**Beta Blocker**: Yes (UX depends on freshness)  
**Discovered**: 2025-09-26  
**Status**: RESOLVED  
**Resolved**: 2025-09-28

## Problem Description

Clients need to know data recency and staleness. We should include timestamps and a simple staleness policy in responses.

## Investigation Areas

1. Consistent `updated_at` stamping across services.  
2. Configurable threshold via `REFRESH_INTERVAL_SECONDS`.  
3. Top-level response metadata: `as_of`, `staleness_seconds`.

## Expected Behavior

Items include `updated_at` and `is_stale`. Responses include `as_of` and `staleness_seconds`. UI can show freshness badges and filter stale.

## Files to Investigate

- `backend/app/api/routes/opportunities.py`  
- `backend/app/api/routes/odds.py`  
- `backend/app/services/*`

## Root Cause Analysis

1. **Primary Cause**: Missing freshness policy.  
2. **Contributing Factors**: Multiple cache points.

## Solution Implemented

### 1. Freshness Metadata (âœ… Complete)
- Compute `is_stale` based on threshold; add response metadata.  
- Keep backward compatibility; additive fields only.

### Code Changes

**File Modified**: `backend/app/api/routes/opportunities.py`

**Before**:
```text
No freshness metadata.
```

**After**:
```text
Include `as_of`, `staleness_seconds`, and item `is_stale`.
```

## Testing Requirements

### Manual Testing Steps
1. Call endpoints; verify freshness fields.  
2. Simulate staleness with threshold tweaks.

### Test Scenarios
- [x] Items older than threshold flagged stale.  
- [x] Metadata present and accurate.

## Status

**Current Status**: RESOLVED  
**Last Updated**: 2025-09-28

### Implementation Checklist
- [x] Add freshness fields and metadata  
- [x] Tests updated

### Completion Criteria (Ready for User Testing)
- [x] Freshness visible and correct  
- [x] Tests pass

### User Testing Confirmation
- [x] User validates freshness behavior  
- [x] User approves moving to done/complete

### User Confirmation & Actions Required
- Confirm default threshold (e.g., 600s) acceptable.

## Result

`is_stale` computed per item; `/api/opportunities/meta` returns freshness metadata; tests added.
 
Closing notes: Also added pretty-printed JSON responses and kept `/api/opportunities` shape backward compatible.
