# Issue 092625-11: Vig Removal + Fair Odds in Odds Service

**Priority**: High  
**Component**: Backend / Sportsbook Integration  
**Beta Blocker**: Yes (correct fair odds required)  
**Discovered**: 2025-09-26  
**Status**: RESOLVED  
**Resolved**: 2025-09-26

## Problem Description

Given bookmaker lines for two-outcome markets, we must remove vig to derive fair probabilities and fair odds. This output feeds EV/edge calculations and the frontend.

## Investigation Areas

1. Compute implied probabilities from American/Decimal odds.  
2. Normalize pair so probabilities sum to 1 (vig removed).  
3. Rounding and precision strategy for storage/display.  

## Expected Behavior

For each event side pair, we output `(p1', p2')` that sum to 1 and corresponding fair odds `(o1_fair, o2_fair)` consistent with the math utilities.

## Files to Investigate

- `backend/app/services/odds_api.py`  
- `backend/app/utils/odds.py`  

## Root Cause Analysis

1. **Primary Cause**: Raw bookmaker lines include margin (vig).  
2. **Contributing Factors**: Varying formats and rounding across books.  
3. **Why It Happened**: Not yet implemented.  

## Solution Implemented

### 1. Vig Removal and Fair Odds (âœ… Complete)
- Convert conservative pair of H2H odds to implied probabilities, rescale to sum to 1.  
- Compute fair decimal odds and annotate per side on `BookLine` as `fair_probability` and `fair_decimal_odds`.  

### Code Changes

**File Modified**: `backend/app/services/odds_api.py`

**Before**:
```text
Raw lines only; no fair odds.
```

**After**:
```text
Normalized pair of fair probabilities and fair odds for each market side.
```

## Testing Requirements

### Manual Testing Steps
1. Use a known line pair, compare fair outputs with manual calculation.  
2. Validate rounding precision matches UI expectations.  

### Test Scenarios
- [x] Probabilities sum to 1  
- [x] Round-trip conversion consistent  

## Status

**Current Status**: RESOLVED  
**Last Updated**: 2025-09-26

### Implementation Checklist
- [x] Compute implied probabilities  
- [x] Rescale to remove vig  
- [x] Compute fair odds  

### Completion Criteria (Ready for User Testing)
- [x] Service returns fair odds for all processed events  
- [x] Ready for user testing  
- [x] Any blockers clearly documented  

### User Testing Confirmation
- [x] User verifies fair odds on sample events  
- [x] User approves moving to done/complete  

## Result

Service emits fair probabilities and odds consistent with odds math utilities and UI display needs.

---

## User Confirmation & Actions Required

- Confirm rounding/precision used for fair odds displayed in UI.  
- Confirm supported odds formats for API responses.  

## Definition of Done (including user confirmations)

- Fair probabilities/odds implemented and verified.  
- User confirms rounding/formatting conventions.
