# Issue 092625-31: Baseline EV Policy (Polymarket-only = 0) and Null-safe Fields

**Priority**: High  
**Component**: Backend / Opportunity Model  
**Beta Blocker**: Yes (prevents misleading EV during bring-up)  
**Discovered**: 2025-09-26  
**Status**: RESOLVED  
**Resolved**: 2025-09-28

## Problem Description

EV should be defined by comparing two sources (e.g., sportsbook vs Polymarket). Today we only surface Polymarket data, so EV must not imply an advantage. Baseline policy: when there is no comparison source, set `ev_usd_per_share = 0` and `ev_percent = 0`, and annotate the basis so the UI and downstream logic behave predictably.

## Investigation Areas

1. Define baseline EV contract for Polymarket-only opportunities.  
2. Ensure no hidden fee-based negative EV is auto-applied.  
3. Add `comparison_basis` and `comparison_sources` to DTO for clarity.  
4. Maintain backward compatibility in API shape.

## Expected Behavior

When only Polymarket is available: `ev_usd_per_share = 0`, `ev_percent = 0`, and `comparison_basis = "none"`. When comparison is added in later issues, EV will be computed against that basis. Existing endpoints remain stable.

## Files to Investigate

- `backend/app/services/opportunities.py` (EV fields policy)  
- `backend/app/schemas/opportunity.py` (new fields)  
- `backend/tests/` (baseline tests)

## Root Cause Analysis

1. **Primary Cause**: EV was implied without a comparison source.  
2. **Contributing Factors**: Early placeholder math and fee cushion led to misleading negative EV.  
3. **Why It Happened**: Comparison engine not yet implemented.

## Solution Implemented

### 1. Baseline EV Contract (✅ Complete)
- When `comparison_sources` empty: set EV fields to 0 and `comparison_basis = none`.  
- Add `comparison_basis` and `comparison_sources` to `Opportunity` schema.

### 2. Baseline Tests (✅ Complete)
- Assert EV fields are 0 for Polymarket-only opportunities.  
- Assert `comparison_basis` is `none` until sportsbook join lands.

### Code Changes

**File Modified**: `backend/app/services/opportunities.py`

**Before**:
```text
EV fields derived from single-source data, sometimes negative.
```

**After**:
```text
EV fields set to 0 with explicit `comparison_basis = none` when only Polymarket is present.
```

## Testing Requirements

### Manual Testing Steps
1. Hit `/api/opportunities` and verify EV fields are 0 and `comparison_basis = none`.  
2. Confirm no negative EV is shown in Polymarket-only mode.  
3. Re-run after later issues (join) to see EV computed against sportsbook.

### Test Scenarios
- [ ] EV fields are 0 for PM-only.  
- [ ] `comparison_basis` present and equals `none`.  
- [ ] No regressions in existing tests.

## Status

**Current Status**: RESOLVED  
**Last Updated**: 2025-09-28

### Implementation Checklist
- [x] Add `comparison_basis`/`comparison_sources` to schema  
- [x] Set EV=0 when PM-only  
- [x] Add baseline tests

### Completion Criteria (Ready for User Testing)
- [ ] Code compiles without errors  
- [ ] All tests pass  
- [ ] EV baseline policy visible via API  
- [ ] Ready for user testing  
- [ ] Any blockers clearly documented

### User Testing Confirmation
- [ ] User has tested the baseline outputs  
- [ ] User confirms EV baseline of 0 for PM-only  
- [ ] User approves moving to done/complete

### User Confirmation & Actions Required
- Confirm baseline that Polymarket-only EV should be exactly 0 with `comparison_basis = none`.  
- Confirm we defer fee effects on EV until comparison engine lands.

## Result

Baseline EV=0 with `comparison_basis=none` implemented and tested; API returns expected fields.
