# Issue 092625-32: Polymarket Normalization Hardening (Data Completeness)

**Priority**: High  
**Component**: Backend / Polymarket Integration  
**Beta Blocker**: Yes (downstream join and UI require complete fields)  
**Discovered**: 2025-09-26  
**Status**: New  
**Resolved**: 

## Problem Description

Normalized Polymarket markets occasionally contain missing or invalid values (e.g., absent Yes/No outcomes, prices out of (0,1), null titles/sport). We must harden normalization so all surfaced binary markets are complete and valid.

## Investigation Areas

1. Outcome parsing for two-outcome (Yes/No) markets; skip multi-outcome.  
2. Price derivation and clamping; reject 0 or 1 values.  
3. Event metadata extraction (title, event_id), and sport tagging hook (see 33).

## Expected Behavior

Every surfaced market includes `event_id`, `market_id`, `title`, `sport` (once 33 lands), and two outcomes (`Yes`, `No`) with prices strictly in (0,1). Incomplete/invalid markets are dropped early.

## Files to Investigate

- `backend/app/services/polymarket.py`  
- `backend/app/schemas/polymarket.py`  
- `backend/tests/test_polymarket_normalize.py`

## Root Cause Analysis

1. **Primary Cause**: Insufficient guards and null checks during normalization.  
2. **Contributing Factors**: Variability in upstream fields and IDs.  
3. **Why It Happened**: Early-stage normalization before taxonomy integration.

## Solution Implemented

### 1. Normalization Hardening (‚è≥ In Progress)
- Strict checks for two outcomes; derive Yes price and compute No = 1 - Yes.  
- Clamp prices and reject 0 or 1.  
- Enforce presence of `event_id`, `market_id`, and human-friendly `title`.

### Code Changes

**File Modified**: `backend/app/services/polymarket.py`

**Before**:
```text
Some markets missing normalized values; allowed borderline prices.
```

**After**:
```text
Markets validated; incomplete/invalid markets discarded; outputs complete.
```

## Testing Requirements

### Manual Testing Steps
1. Run normalization over a sample page; inspect a few markets.  
2. Verify no `None` for required fields; prices within (0,1).

### Test Scenarios
- [ ] Markets without both outcomes are skipped.  
- [ ] Prices are within (0,1) and sum to ~1 (pre-fee).  
- [ ] Titles and IDs present.

## Status

**Current Status**: Planned  
**Last Updated**: 2025-09-26

### Implementation Checklist
- [ ] Add guards and validations  
- [ ] Update tests  
- [ ] Verify sample payloads

### Completion Criteria (Ready for User Testing)
- [ ] No incomplete records in output  
- [ ] Tests pass

### User Testing Confirmation
- [ ] User validates normalization outputs look complete  
- [ ] User approves moving to done/complete

### User Confirmation & Actions Required
- None.

## Result

[TBD]


