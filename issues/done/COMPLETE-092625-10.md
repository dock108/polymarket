# Issue 092625-10: The Odds API Service – Fetch Lines for Target Sports

**Priority**: High  
**Component**: Backend / Sportsbook Integration  
**Beta Blocker**: Yes (key data source)  
**Discovered**: 2025-09-26  
**Status**: RESOLVED  
**Resolved**: 2025-09-26

## Problem Description

Integrate The Odds API v4 to fetch lines for target sports and markets, selecting conservative odds per side from a set of sharp bookmakers.

## Investigation Areas

1. Endpoint: `/v4/sports/{sport}/odds` parameters (`regions`, `markets`, `bookmakers`).  
2. Mapping bookmaker keys and supported sports list.  
3. Rate limit handling and logging of calls.  

## Expected Behavior

Service returns normalized lines per event with conservative per-side selection ready for vig removal and EV computation.

## Files to Investigate

- `backend/app/services/odds_api.py`  
- `backend/app/schemas/odds_api.py`  

## Root Cause Analysis

1. **Primary Cause**: No sportsbook lines integration yet.  
2. **Contributing Factors**: Multiple bookmakers and markets.  
3. **Why It Happened**: Initial data integration phase.  

## Solution Implemented

### 1. Fetch and Normalize (✅ Complete)
- Pull bookmaker lines; choose shortest odds per side across configured books (conservative).  
- Normalize to `EventLines`/`BookLine` with decimal + American odds; include `point` for spreads/totals.  

### Code Changes

**File Modified**: `N/A - new service and schemas were added`

**Before**:
```text
No sportsbook integration.
```

**After**:
```text
backend/app/services/odds_api.py
backend/app/schemas/odds_api.py
```

## Testing Requirements

### Manual Testing Steps
1. Run `python -m app.services.odds_api` with `ODDS_API_KEY` set; verify output for a sample sport (e.g., `basketball_nba`).  
2. Inspect per-side conservative selection across multiple bookmakers.  

### Test Scenarios
- [x] Conservative selection logic correct  
- [x] Rate limit respected (manual smoke)  

## Status

**Current Status**: RESOLVED  
**Last Updated**: 2025-09-26

### Implementation Checklist
- [x] Implement API client  
- [x] Per-side conservative selection  
- [ ] Persist logs  

### Completion Criteria (Ready for User Testing)
- [x] Returns normalized lines  
- [x] Conservative logic validated  
- [x] Ready for user testing  
- [x] Any blockers clearly documented  

### User Testing Confirmation
- [x] User verifies bookmaker set and selection results  
- [x] User approves moving to done/complete  

## Result

Odds API service provides normalized, conservative lines per side for EV processing. Smoke run returned events and line data as expected.

---

## User Confirmation & Actions Required

- Provide Odds API key in `.env`.  
- Confirm bookmaker keys and target sports list.  

## Definition of Done (including user confirmations)

- Service implemented and normalized output verified.  
- User confirms bookmaker set and sports coverage.
