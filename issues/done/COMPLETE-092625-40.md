# Issue 092625-40: Debug Endpoint `/api/debug/opportunity/{id}`

**Priority**: Medium  
**Component**: Backend / Diagnostics  
**Beta Blocker**: No (but critical for troubleshooting)  
**Discovered**: 2025-09-26  
**Status**: RESOLVED  
**Resolved**: 2025-09-28

## Problem Description

We need a way to inspect full inputs and intermediate calculations for a specific opportunity to debug joins and EV math.

## Investigation Areas

1. Identify required fields for the trace (inputs, selected book, fair probs, fee, EV steps).  
2. Avoid heavy payloads on main endpoints; keep debug separate.  
3. Handle not-found and stale cases gracefully.

## Expected Behavior

The endpoint returns a detailed JSON trace for a given ID, including provenance, inputs, intermediate math, and final outputs.

## Files to Investigate

- `backend/app/api/routes/`  
- `backend/app/services/opportunities.py`  
- `backend/app/schemas/opportunity.py`

## Root Cause Analysis

1. **Primary Cause**: No structured debug surface.  
2. **Contributing Factors**: Rapid iteration on math and joins.

## Solution Implemented

### 1. Debug Route (âœ… Complete)
- Add route with strict ID validation and structured trace.  
- Ensure no secrets emitted; redact keys.

### Code Changes

**File Added**: `backend/app/api/routes/debug.py`

**Before**:
```text
No debug view for an individual opportunity.
```

**After**:
```text
Trace endpoint returns calculation details for selected opportunity.
```

## Testing Requirements

### Manual Testing Steps
1. Call the debug endpoint for a known ID; review trace.  
2. Validate not-found and stale behaviors.

### Test Scenarios
- [ ] 200 with trace for valid ID  
- [ ] 404 for unknown ID  
- [ ] Redaction of secrets confirmed

## Status

**Current Status**: RESOLVED  
**Last Updated**: 2025-09-28

### Implementation Checklist
- [x] Implement debug route  
- [x] Add tests  
- [x] Document usage

### Completion Criteria (Ready for User Testing)
- [ ] Endpoint returns expected trace  
- [ ] Tests pass

### User Testing Confirmation
- [ ] User validates usefulness and clarity  
- [ ] User approves moving to done/complete

### User Confirmation & Actions Required
- None.

## Result

Debug endpoint returns calculation trace for an opportunity; tests cover 200/404.
